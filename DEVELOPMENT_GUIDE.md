# PyInstaller GUI é¡¹ç›®å¼€å‘æŒ‡å¯¼æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£ä¸º PyInstaller GUI é¡¹ç›®çš„å®Œæ•´å¼€å‘æŒ‡å¯¼ï¼ŒåŸºäºæ·±åº¦é¡¹ç›®åˆ†æåˆ¶å®šï¼ŒåŒ…å«è¯¦ç»†çš„ä¼˜åŒ–è®¡åˆ’ã€ä»»åŠ¡è¿›åº¦è·Ÿè¸ªå’Œå®æ–½æŒ‡å—ã€‚

### é¡¹ç›®åŸºæœ¬ä¿¡æ¯
- **é¡¹ç›®åç§°**: PyInstaller æ‰“åŒ…å·¥å…·
- **ç‰ˆæœ¬**: 1.0.1
- **æŠ€æœ¯æ ˆ**: Python 3.x + PyQt5 + PyInstaller
- **æ¶æ„æ¨¡å¼**: MVC (Model-View-Controller)
- **å¼€å‘çŠ¶æ€**: ç”Ÿäº§å°±ç»ªï¼Œéœ€è¦ä¼˜åŒ–

## ğŸ¯ å¼€å‘ç›®æ ‡

### çŸ­æœŸç›®æ ‡ (1-2ä¸ªæœˆ)
- ä¼˜åŒ–æ ¸å¿ƒåŠŸèƒ½æ€§èƒ½å’Œç¨³å®šæ€§
- æå‡ç”¨æˆ·ä½“éªŒå’Œç•Œé¢ç°ä»£åŒ–
- å®Œå–„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ç®¡ç†

### ä¸­æœŸç›®æ ‡ (3-6ä¸ªæœˆ)
- å®ç°é«˜çº§åŠŸèƒ½å’Œæ‰©å±•æ€§
- å»ºç«‹å®Œå–„çš„æµ‹è¯•ä½“ç³»
- ä¼˜åŒ–ä»£ç è´¨é‡å’Œæ¶æ„

### é•¿æœŸç›®æ ‡ (6ä¸ªæœˆä»¥ä¸Š)
- æ„å»ºæ’ä»¶ç”Ÿæ€ç³»ç»Ÿ
- æ”¯æŒäº‘ç«¯åŠŸèƒ½
- å»ºç«‹ç¤¾åŒºå’Œæ–‡æ¡£ä½“ç³»

## ğŸ“Š ä»»åŠ¡è¿›åº¦è·Ÿè¸ª

### ğŸŸ¢ å·²å®Œæˆä»»åŠ¡
- [x] **é¡¹ç›®ä¼˜åŒ–åˆ†æ** (100%)
  - å®Œæˆé¡¹ç›®æ¶æ„åˆ†æ
  - è¯†åˆ«ä¼˜åŒ–æœºä¼šå’Œæ”¹è¿›ç‚¹
  - åˆ¶å®šè¯¦ç»†çš„å®æ–½è®¡åˆ’

### ğŸŸ¡ è¿›è¡Œä¸­ä»»åŠ¡
- [/] **åˆ›å»ºå¼€å‘æŒ‡å¯¼æ–‡æ¡£** (80%)
  - å®Œæˆæ–‡æ¡£æ¡†æ¶è®¾è®¡
  - æ­£åœ¨ç¼–å†™è¯¦ç»†å®æ–½æŒ‡å—
  - å¾…å®Œæˆï¼šä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

### ğŸ”´ å¾…å¼€å§‹ä»»åŠ¡

#### ä¼˜å…ˆçº§1ï¼šæ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ– (é¢„è®¡4-6å‘¨)
- [ ] **å¼‚æ­¥æ‰“åŒ…å¤„ç†** (0%)
  - ä¼°è®¡å·¥æ—¶ï¼š2å‘¨
  - è´Ÿè´£äººï¼šå¾…åˆ†é…
  - ä¾èµ–ï¼šæ— 
  
- [ ] **æ™ºèƒ½ä¾èµ–æ£€æµ‹ä¼˜åŒ–** (0%)
  - ä¼°è®¡å·¥æ—¶ï¼š2-3å‘¨
  - è´Ÿè´£äººï¼šå¾…åˆ†é…
  - ä¾èµ–ï¼šæ— 
  
- [ ] **é”™è¯¯å¤„ç†å¢å¼º** (0%)
  - ä¼°è®¡å·¥æ—¶ï¼š1-2å‘¨
  - è´Ÿè´£äººï¼šå¾…åˆ†é…
  - ä¾èµ–ï¼šå¼‚æ­¥æ‰“åŒ…å¤„ç†

#### ä¼˜å…ˆçº§2ï¼šç”¨æˆ·ä½“éªŒæå‡ (é¢„è®¡3-4å‘¨)
- [ ] **ç•Œé¢ç°ä»£åŒ–** (0%)
  - ä¼°è®¡å·¥æ—¶ï¼š2-3å‘¨
  - è´Ÿè´£äººï¼šå¾…åˆ†é…
  - ä¾èµ–ï¼šæ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ–å®Œæˆ
  
- [ ] **åŠŸèƒ½å¢å¼º** (0%)
  - ä¼°è®¡å·¥æ—¶ï¼š1-2å‘¨
  - è´Ÿè´£äººï¼šå¾…åˆ†é…
  - ä¾èµ–ï¼šç•Œé¢ç°ä»£åŒ–

#### ä¼˜å…ˆçº§3ï¼šæ‰©å±•åŠŸèƒ½ (é¢„è®¡6-8å‘¨)
- [ ] **é«˜çº§åŠŸèƒ½å¼€å‘** (0%)
  - ä¼°è®¡å·¥æ—¶ï¼š4-5å‘¨
  - è´Ÿè´£äººï¼šå¾…åˆ†é…
  - ä¾èµ–ï¼šç”¨æˆ·ä½“éªŒæå‡å®Œæˆ
  
- [ ] **å¼€å‘è€…å·¥å…·** (0%)
  - ä¼°è®¡å·¥æ—¶ï¼š2-3å‘¨
  - è´Ÿè´£äººï¼šå¾…åˆ†é…
  - ä¾èµ–ï¼šé«˜çº§åŠŸèƒ½å¼€å‘

## ğŸš€ è¯¦ç»†å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ– (4-6å‘¨)

#### 1.1 å¼‚æ­¥æ‰“åŒ…å¤„ç† (2å‘¨)

**ç›®æ ‡**: å°†åŒæ­¥æ‰“åŒ…è¿‡ç¨‹æ”¹ä¸ºå¼‚æ­¥æ‰§è¡Œï¼Œæå‡ç”¨æˆ·ä½“éªŒ

**æŠ€æœ¯è¦æ±‚**:
- ä½¿ç”¨ QThread æˆ– QRunnable å®ç°åå°å¤„ç†
- å®ç°è¿›åº¦å›è°ƒå’ŒçŠ¶æ€æ›´æ–°
- æ”¯æŒæ‰“åŒ…è¿‡ç¨‹çš„å–æ¶ˆæ“ä½œ
- æ·»åŠ è¶…æ—¶å¤„ç†æœºåˆ¶

**å®æ–½æ­¥éª¤**:
1. **ç¬¬1-2å¤©**: è®¾è®¡å¼‚æ­¥æ¶æ„
   - åˆ›å»º `AsyncPackageWorker` ç±»
   - å®šä¹‰ä¿¡å·å’Œæ§½æœºåˆ¶
   - è®¾è®¡è¿›åº¦å›è°ƒæ¥å£

2. **ç¬¬3-5å¤©**: å®ç°æ ¸å¿ƒåŠŸèƒ½
   - é‡æ„ `PackageService` ç±»
   - å®ç°å¼‚æ­¥æ‰§è¡Œé€»è¾‘
   - æ·»åŠ è¿›åº¦è¿½è¸ªåŠŸèƒ½

3. **ç¬¬6-8å¤©**: UIé›†æˆå’Œæµ‹è¯•
   - æ›´æ–°ä¸»çª—å£çš„æ‰“åŒ…é€»è¾‘
   - å®ç°è¿›åº¦æ¡å’ŒçŠ¶æ€æ˜¾ç¤º
   - æ·»åŠ å–æ¶ˆæŒ‰é’®åŠŸèƒ½

4. **ç¬¬9-10å¤©**: æµ‹è¯•å’Œä¼˜åŒ–
   - å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
   - æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†
   - æ–‡æ¡£æ›´æ–°

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰“åŒ…è¿‡ç¨‹ä¸é˜»å¡UIç•Œé¢
- [ ] å®æ—¶æ˜¾ç¤ºæ‰“åŒ…è¿›åº¦
- [ ] æ”¯æŒå–æ¶ˆæ­£åœ¨è¿›è¡Œçš„æ‰“åŒ…
- [ ] å¼‚å¸¸æƒ…å†µä¸‹èƒ½æ­£ç¡®æ¢å¤

**å…³é”®æ–‡ä»¶**:
- `services/async_package_service.py` (æ–°å»º)
- `views/main_window.py` (ä¿®æ”¹)
- `controllers/main_controller.py` (ä¿®æ”¹)

#### 1.2 æ™ºèƒ½ä¾èµ–æ£€æµ‹ä¼˜åŒ– (2-3å‘¨)

**ç›®æ ‡**: æå‡æ¨¡å—æ£€æµ‹çš„å‡†ç¡®æ€§å’Œæ€§èƒ½

**æŠ€æœ¯è¦æ±‚**:
- ä¼˜åŒ–ASTè§£æç®—æ³•
- æ·»åŠ ç¼“å­˜æœºåˆ¶
- æ”¯æŒå¸¸è§æ¡†æ¶çš„é¢„è®¾é…ç½®
- å®ç°ä¾èµ–å†²çªæ£€æµ‹

**å®æ–½æ­¥éª¤**:
1. **ç¬¬1-3å¤©**: ç®—æ³•ä¼˜åŒ–
   - åˆ†æç°æœ‰æ£€æµ‹ç®—æ³•çš„æ€§èƒ½ç“¶é¢ˆ
   - å®ç°å¢é‡æ£€æµ‹æœºåˆ¶
   - æ·»åŠ ç»“æœç¼“å­˜åŠŸèƒ½

2. **ç¬¬4-7å¤©**: é¢„è®¾é…ç½®ç³»ç»Ÿ
   - åˆ›å»ºæ¡†æ¶é…ç½®æ¨¡æ¿
   - å®ç°é…ç½®è‡ªåŠ¨åŒ¹é…
   - æ·»åŠ ç”¨æˆ·è‡ªå®šä¹‰é…ç½®

3. **ç¬¬8-12å¤©**: å†²çªæ£€æµ‹åŠŸèƒ½
   - å®ç°ä¾èµ–å…³ç³»åˆ†æ
   - æ·»åŠ ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
   - æä¾›è§£å†³æ–¹æ¡ˆå»ºè®®

4. **ç¬¬13-15å¤©**: æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•
   - å¹¶è¡Œå¤„ç†ä¼˜åŒ–
   - å†…å­˜ä½¿ç”¨ä¼˜åŒ–
   - å…¨é¢æµ‹è¯•éªŒè¯

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ£€æµ‹é€Ÿåº¦æå‡50%ä»¥ä¸Š
- [ ] æ”¯æŒä¸»æµæ¡†æ¶è‡ªåŠ¨é…ç½®
- [ ] èƒ½è¯†åˆ«å¹¶æç¤ºä¾èµ–å†²çª
- [ ] ç¼“å­˜æœºåˆ¶æ­£å¸¸å·¥ä½œ

**å…³é”®æ–‡ä»¶**:
- `services/enhanced_module_detector.py` (æ–°å»º)
- `config/framework_templates.py` (æ–°å»º)
- `services/dependency_analyzer.py` (æ–°å»º)

#### 1.3 é”™è¯¯å¤„ç†å¢å¼º (1-2å‘¨)

**ç›®æ ‡**: å»ºç«‹ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

**æŠ€æœ¯è¦æ±‚**:
- åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨
- å®ç°è¯¦ç»†çš„é”™è¯¯è¯Šæ–­
- æä¾›è‡ªåŠ¨ä¿®å¤å»ºè®®
- æ·»åŠ é”™è¯¯æŠ¥å‘ŠåŠŸèƒ½

**å®æ–½æ­¥éª¤**:
1. **ç¬¬1-2å¤©**: å¼‚å¸¸å¤„ç†æ¶æ„è®¾è®¡
2. **ç¬¬3-5å¤©**: å®ç°æ ¸å¿ƒå¤„ç†é€»è¾‘
3. **ç¬¬6-8å¤©**: é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
4. **ç¬¬9-10å¤©**: æµ‹è¯•å’Œæ–‡æ¡£

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- [ ] ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- [ ] è‡ªåŠ¨ä¿®å¤å»ºè®®åŠŸèƒ½
- [ ] é”™è¯¯æ—¥å¿—å’ŒæŠ¥å‘Š

### é˜¶æ®µäºŒï¼šç”¨æˆ·ä½“éªŒæå‡ (3-4å‘¨)

#### 2.1 ç•Œé¢ç°ä»£åŒ– (2-3å‘¨)

**ç›®æ ‡**: æå‡ç•Œé¢çš„ç°ä»£æ„Ÿå’Œæ˜“ç”¨æ€§

**æŠ€æœ¯è¦æ±‚**:
- é‡‡ç”¨Material Designè®¾è®¡è¯­è¨€
- å®ç°æš—è‰²ä¸»é¢˜æ”¯æŒ
- å“åº”å¼å¸ƒå±€è®¾è®¡
- åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ

**å®æ–½æ­¥éª¤**:
1. **ç¬¬1-3å¤©**: è®¾è®¡ç³»ç»Ÿå»ºç«‹
2. **ç¬¬4-8å¤©**: ç»„ä»¶é‡æ„å’Œæ ·å¼åº”ç”¨
3. **ç¬¬9-12å¤©**: ä¸»é¢˜ç³»ç»Ÿå®ç°
4. **ç¬¬13-15å¤©**: æµ‹è¯•å’Œä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç°ä»£åŒ–çš„è§†è§‰è®¾è®¡
- [ ] å®Œæ•´çš„æš—è‰²ä¸»é¢˜æ”¯æŒ
- [ ] å“åº”å¼å¸ƒå±€é€‚é…
- [ ] æµç•…çš„åŠ¨ç”»æ•ˆæœ

#### 2.2 åŠŸèƒ½å¢å¼º (1-2å‘¨)

**ç›®æ ‡**: æ·»åŠ å®ç”¨çš„äº¤äº’åŠŸèƒ½

**æŠ€æœ¯è¦æ±‚**:
- æ‹–æ‹½æ–‡ä»¶æ”¯æŒ
- é…ç½®æ¨¡æ¿ç³»ç»Ÿ
- å†å²è®°å½•ç®¡ç†
- å¿«æ·é”®æ”¯æŒ

**å®æ–½æ­¥éª¤**:
1. **ç¬¬1-3å¤©**: æ‹–æ‹½åŠŸèƒ½å®ç°
2. **ç¬¬4-6å¤©**: æ¨¡æ¿ç³»ç»Ÿå¼€å‘
3. **ç¬¬7-9å¤©**: å†å²è®°å½•åŠŸèƒ½
4. **ç¬¬10å¤©**: å¿«æ·é”®å’Œæµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ”¯æŒæ‹–æ‹½æ–‡ä»¶åˆ°ç•Œé¢
- [ ] é…ç½®æ¨¡æ¿ä¿å­˜å’ŒåŠ è½½
- [ ] å†å²è®°å½•æŸ¥çœ‹å’Œæ¢å¤
- [ ] å¸¸ç”¨å¿«æ·é”®æ”¯æŒ

### é˜¶æ®µä¸‰ï¼šæ‰©å±•åŠŸèƒ½ (6-8å‘¨)

#### 3.1 é«˜çº§åŠŸèƒ½å¼€å‘ (4-5å‘¨)

**ç›®æ ‡**: å®ç°é«˜çº§åŠŸèƒ½å’Œæ‰©å±•æ€§

**æŠ€æœ¯è¦æ±‚**:
- å¤šç¯å¢ƒæ”¯æŒ
- äº‘ç«¯é…ç½®åŒæ­¥
- æ’ä»¶ç³»ç»Ÿæ¶æ„
- APIæ¥å£è®¾è®¡

#### 3.2 å¼€å‘è€…å·¥å…· (2-3å‘¨)

**ç›®æ ‡**: æä¾›å¼€å‘å’Œè°ƒè¯•å·¥å…·

**æŠ€æœ¯è¦æ±‚**:
- è°ƒè¯•æ¨¡å¼
- æ€§èƒ½åˆ†æå·¥å…·
- è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶
- æ—¥å¿—åˆ†æå·¥å…·

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç è§„èŒƒ
- éµå¾ªPEP 8ç¼–ç è§„èŒƒ
- ä½¿ç”¨ç±»å‹æ³¨è§£ (Type Hints)
- ç¼–å†™å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²
- ä¿æŒå‡½æ•°å’Œç±»çš„å•ä¸€èŒè´£

### æµ‹è¯•è§„èŒƒ
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- é›†æˆæµ‹è¯•è¦†ç›–ä¸»è¦åŠŸèƒ½
- UIæµ‹è¯•è¦†ç›–å…³é”®äº¤äº’
- æ€§èƒ½æµ‹è¯•éªŒè¯ä¼˜åŒ–æ•ˆæœ

### ç‰ˆæœ¬æ§åˆ¶
- ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·
- è¯¦ç»†çš„æäº¤ä¿¡æ¯
- åŠŸèƒ½åˆ†æ”¯å¼€å‘æ¨¡å¼
- ä»£ç å®¡æŸ¥æœºåˆ¶

## ğŸ”§ å¼€å‘ç¯å¢ƒé…ç½®

### å¿…éœ€å·¥å…·
- Python 3.8+
- PyQt5 5.15+
- PyInstaller 5.0+
- Git

### æ¨èå·¥å…·
- VS Code / PyCharm
- Black (ä»£ç æ ¼å¼åŒ–)
- Pylint (ä»£ç æ£€æŸ¥)
- Pytest (æµ‹è¯•æ¡†æ¶)

### ç¯å¢ƒè®¾ç½®
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-dev.txt

# è¿è¡Œé¡¹ç›®
python run.py
```

## ğŸ“š å‚è€ƒèµ„æº

### æŠ€æœ¯æ–‡æ¡£
- [PyQt5 å®˜æ–¹æ–‡æ¡£](https://doc.qt.io/qtforpython/)
- [PyInstaller æ–‡æ¡£](https://pyinstaller.readthedocs.io/)
- [Python ç±»å‹æ³¨è§£æŒ‡å—](https://docs.python.org/3/library/typing.html)

### è®¾è®¡èµ„æº
- [Material Design æŒ‡å—](https://material.io/design)
- [Qt Style Sheets](https://doc.qt.io/qt-5/stylesheet.html)

## ğŸ’» æŠ€æœ¯å®ç°æŒ‡å—

### å¼‚æ­¥æ‰“åŒ…å¤„ç†å®ç°ç¤ºä¾‹

#### åˆ›å»ºå¼‚æ­¥å·¥ä½œçº¿ç¨‹

```python
# services/async_package_service.py
from PyQt5.QtCore import QThread, pyqtSignal, QObject
from typing import Optional, Callable
import subprocess
import os

class AsyncPackageWorker(QThread):
    """å¼‚æ­¥æ‰“åŒ…å·¥ä½œçº¿ç¨‹"""

    # ä¿¡å·å®šä¹‰
    progress_updated = pyqtSignal(int)  # è¿›åº¦æ›´æ–°
    output_received = pyqtSignal(str)   # è¾“å‡ºä¿¡æ¯
    error_occurred = pyqtSignal(str)    # é”™è¯¯ä¿¡æ¯
    finished_signal = pyqtSignal(bool, str)  # å®Œæˆä¿¡å·

    def __init__(self, model, python_interpreter=""):
        super().__init__()
        self.model = model
        self.python_interpreter = python_interpreter
        self.process: Optional[subprocess.Popen] = None
        self._cancelled = False

    def run(self):
        """æ‰§è¡Œæ‰“åŒ…ä»»åŠ¡"""
        try:
            self.output_received.emit("å¼€å§‹å‡†å¤‡æ‰“åŒ…...")
            self.progress_updated.emit(10)

            # ç”Ÿæˆæ‰“åŒ…å‘½ä»¤
            command = self.model.generate_command()
            if not command:
                self.error_occurred.emit("æ— æ³•ç”Ÿæˆæ‰“åŒ…å‘½ä»¤")
                return

            self.output_received.emit(f"æ‰§è¡Œå‘½ä»¤: {command}")
            self.progress_updated.emit(20)

            # æ‰§è¡Œæ‰“åŒ…
            self._execute_packaging(command)

        except Exception as e:
            self.error_occurred.emit(f"æ‰“åŒ…è¿‡ç¨‹å‡ºé”™: {str(e)}")
            self.finished_signal.emit(False, str(e))

    def _execute_packaging(self, command: str):
        """æ‰§è¡Œæ‰“åŒ…å‘½ä»¤"""
        try:
            # è®¾ç½®å·¥ä½œç›®å½•
            work_dir = os.path.dirname(self.model.script_path)

            # å¯åŠ¨è¿›ç¨‹
            self.process = subprocess.Popen(
                command,
                shell=True,
                stdout=subprocess.PIPE,
                stderr=subprocess.STDOUT,
                universal_newlines=True,
                cwd=work_dir
            )

            # å®æ—¶è¯»å–è¾“å‡º
            while True:
                if self._cancelled:
                    self.process.terminate()
                    self.finished_signal.emit(False, "ç”¨æˆ·å–æ¶ˆ")
                    return

                output = self.process.stdout.readline()
                if output == '' and self.process.poll() is not None:
                    break

                if output:
                    self.output_received.emit(output.strip())
                    # æ ¹æ®è¾“å‡ºå†…å®¹æ›´æ–°è¿›åº¦
                    self._update_progress_from_output(output)

            # æ£€æŸ¥ç»“æœ
            return_code = self.process.poll()
            if return_code == 0:
                self.progress_updated.emit(100)
                self.finished_signal.emit(True, "æ‰“åŒ…å®Œæˆ")
            else:
                self.finished_signal.emit(False, f"æ‰“åŒ…å¤±è´¥ï¼Œé€€å‡ºç : {return_code}")

        except Exception as e:
            self.finished_signal.emit(False, f"æ‰§è¡Œé”™è¯¯: {str(e)}")

    def _update_progress_from_output(self, output: str):
        """æ ¹æ®è¾“å‡ºå†…å®¹æ›´æ–°è¿›åº¦"""
        # ç®€å•çš„è¿›åº¦ä¼°ç®—é€»è¾‘
        if "INFO: Building" in output:
            self.progress_updated.emit(40)
        elif "INFO: Collecting" in output:
            self.progress_updated.emit(60)
        elif "INFO: Building EXE" in output:
            self.progress_updated.emit(80)
        elif "successfully created" in output:
            self.progress_updated.emit(95)

    def cancel(self):
        """å–æ¶ˆæ‰“åŒ…"""
        self._cancelled = True
        if self.process:
            self.process.terminate()
```

#### é›†æˆåˆ°ä¸»çª—å£

```python
# views/main_window.py (ä¿®æ”¹éƒ¨åˆ†)
def start_package(self) -> None:
    """å¼€å§‹æ‰“åŒ… - å¼‚æ­¥ç‰ˆæœ¬"""
    # éªŒè¯é…ç½®
    if not self.model.script_path:
        QMessageBox.warning(self, "é”™è¯¯", "è¯·é€‰æ‹©è¦æ‰“åŒ…çš„Pythonè„šæœ¬")
        return

    # æ¸…ç©ºä¸Šä¸€æ¬¡çš„æ—¥å¿—
    if self.log_tab:
        self.log_tab.clear_log()

    # åˆ‡æ¢åˆ°æ—¥å¿—æ ‡ç­¾é¡µ
    self.tab_widget.setCurrentWidget(self.log_tab)

    # åˆ›å»ºå¼‚æ­¥å·¥ä½œçº¿ç¨‹
    python_interpreter = self.config.get("python_interpreter", "")
    self.package_worker = AsyncPackageWorker(self.model, python_interpreter)

    # è¿æ¥ä¿¡å·
    self.package_worker.progress_updated.connect(self.log_tab.update_progress)
    self.package_worker.output_received.connect(self.log_tab.append_log)
    self.package_worker.error_occurred.connect(self.log_tab.append_error)
    self.package_worker.finished_signal.connect(self.on_package_finished)

    # æ›´æ–°UIçŠ¶æ€
    self.start_package_btn.setEnabled(False)
    self.cancel_package_btn.setEnabled(True)

    # å¯åŠ¨å¼‚æ­¥ä»»åŠ¡
    self.package_worker.start()

def cancel_package(self) -> None:
    """å–æ¶ˆæ‰“åŒ…"""
    if hasattr(self, 'package_worker') and self.package_worker.isRunning():
        self.package_worker.cancel()
        self.log_tab.append_log("æ­£åœ¨å–æ¶ˆæ‰“åŒ…...")
```

### æ™ºèƒ½ä¾èµ–æ£€æµ‹ä¼˜åŒ–å®ç°

#### å¢å¼ºçš„æ¨¡å—æ£€æµ‹å™¨

```python
# services/enhanced_module_detector.py
import ast
import os
import sys
import json
import hashlib
from typing import Set, Dict, List, Optional, Tuple
from pathlib import Path
import importlib.util

class EnhancedModuleDetector:
    """å¢å¼ºçš„æ¨¡å—æ£€æµ‹å™¨"""

    def __init__(self, cache_dir: str = ".cache"):
        self.cache_dir = Path(cache_dir)
        self.cache_dir.mkdir(exist_ok=True)
        self.framework_configs = self._load_framework_configs()
        self._detection_cache: Dict[str, Set[str]] = {}

    def detect_modules_with_cache(self, script_path: str) -> Set[str]:
        """å¸¦ç¼“å­˜çš„æ¨¡å—æ£€æµ‹"""
        # è®¡ç®—æ–‡ä»¶å“ˆå¸Œ
        file_hash = self._calculate_file_hash(script_path)
        cache_file = self.cache_dir / f"modules_{file_hash}.json"

        # å°è¯•ä»ç¼“å­˜åŠ è½½
        if cache_file.exists():
            try:
                with open(cache_file, 'r', encoding='utf-8') as f:
                    cached_data = json.load(f)
                    return set(cached_data['modules'])
            except Exception:
                pass  # ç¼“å­˜æŸåï¼Œé‡æ–°æ£€æµ‹

        # æ‰§è¡Œæ£€æµ‹
        modules = self._detect_modules_enhanced(script_path)

        # ä¿å­˜åˆ°ç¼“å­˜
        try:
            cache_data = {
                'modules': list(modules),
                'timestamp': os.path.getmtime(script_path),
                'file_hash': file_hash
            }
            with open(cache_file, 'w', encoding='utf-8') as f:
                json.dump(cache_data, f, indent=2)
        except Exception:
            pass  # ç¼“å­˜ä¿å­˜å¤±è´¥ä¸å½±å“ä¸»åŠŸèƒ½

        return modules

    def _detect_modules_enhanced(self, script_path: str) -> Set[str]:
        """å¢å¼ºçš„æ¨¡å—æ£€æµ‹é€»è¾‘"""
        modules = set()

        # ASTé™æ€åˆ†æ
        ast_modules = self._ast_analysis(script_path)
        modules.update(ast_modules)

        # æ¡†æ¶ç‰¹å®šæ£€æµ‹
        framework_modules = self._detect_framework_modules(script_path, ast_modules)
        modules.update(framework_modules)

        # åŠ¨æ€å¯¼å…¥æ£€æµ‹
        dynamic_modules = self._detect_dynamic_imports(script_path)
        modules.update(dynamic_modules)

        return modules

    def _detect_framework_modules(self, script_path: str, detected_modules: Set[str]) -> Set[str]:
        """æ£€æµ‹æ¡†æ¶ç‰¹å®šçš„æ¨¡å—"""
        additional_modules = set()

        for framework, config in self.framework_configs.items():
            # æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†è¯¥æ¡†æ¶
            if any(module in detected_modules for module in config.get('indicators', [])):
                # æ·»åŠ æ¡†æ¶ç›¸å…³çš„éšè—å¯¼å…¥
                additional_modules.update(config.get('hidden_imports', []))

                # æ·»åŠ æ•°æ®æ–‡ä»¶
                data_files = config.get('data_files', [])
                for data_file in data_files:
                    # è¿™é‡Œå¯ä»¥æ·»åŠ æ•°æ®æ–‡ä»¶å¤„ç†é€»è¾‘
                    pass

        return additional_modules

    def _load_framework_configs(self) -> Dict:
        """åŠ è½½æ¡†æ¶é…ç½®"""
        return {
            'django': {
                'indicators': ['django', 'django.core', 'django.conf'],
                'hidden_imports': [
                    'django.core.management',
                    'django.contrib.auth',
                    'django.contrib.contenttypes',
                    'django.contrib.sessions',
                    'django.contrib.messages',
                    'django.contrib.staticfiles'
                ],
                'data_files': ['templates', 'static']
            },
            'flask': {
                'indicators': ['flask', 'flask.app'],
                'hidden_imports': [
                    'flask.json',
                    'flask.logging',
                    'jinja2.ext'
                ],
                'data_files': ['templates', 'static']
            },
            'opencv': {
                'indicators': ['cv2'],
                'hidden_imports': [
                    'numpy.core._multiarray_umath',
                    'numpy.core._multiarray_tests',
                    'numpy.linalg._umath_linalg',
                    'numpy.fft._pocketfft_internal'
                ]
            },
            'matplotlib': {
                'indicators': ['matplotlib', 'matplotlib.pyplot'],
                'hidden_imports': [
                    'matplotlib.backends.backend_tkagg',
                    'matplotlib.backends.backend_qt5agg',
                    'matplotlib.figure',
                    'matplotlib.font_manager'
                ],
                'data_files': ['matplotlib/mpl-data']
            }
        }

    def analyze_dependencies(self, script_path: str) -> Dict:
        """åˆ†æä¾èµ–å…³ç³»å’Œå†²çª"""
        detected_modules = self.detect_modules_with_cache(script_path)

        analysis = {
            'detected_modules': detected_modules,
            'missing_modules': set(),
            'conflicted_modules': set(),
            'recommendations': []
        }

        # æ£€æŸ¥æ¨¡å—æ˜¯å¦å¯ç”¨
        for module in detected_modules:
            if not self._is_module_available(module):
                analysis['missing_modules'].add(module)

        # æ£€æŸ¥ç‰ˆæœ¬å†²çª
        conflicts = self._check_version_conflicts(detected_modules)
        analysis['conflicted_modules'].update(conflicts)

        # ç”Ÿæˆå»ºè®®
        analysis['recommendations'] = self._generate_recommendations(analysis)

        return analysis

    def _calculate_file_hash(self, file_path: str) -> str:
        """è®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼"""
        hasher = hashlib.md5()
        with open(file_path, 'rb') as f:
            hasher.update(f.read())
        return hasher.hexdigest()

    def _is_module_available(self, module_name: str) -> bool:
        """æ£€æŸ¥æ¨¡å—æ˜¯å¦å¯ç”¨"""
        try:
            spec = importlib.util.find_spec(module_name)
            return spec is not None
        except (ImportError, ValueError, ModuleNotFoundError):
            return False

    def _check_version_conflicts(self, modules: Set[str]) -> Set[str]:
        """æ£€æŸ¥ç‰ˆæœ¬å†²çª"""
        # è¿™é‡Œå¯ä»¥å®ç°æ›´å¤æ‚çš„ç‰ˆæœ¬å†²çªæ£€æµ‹é€»è¾‘
        conflicts = set()

        # ç¤ºä¾‹ï¼šæ£€æŸ¥å·²çŸ¥çš„å†²çªç»„åˆ
        known_conflicts = {
            ('tensorflow', 'tensorflow-gpu'): "TensorFlowå’ŒTensorFlow-GPUä¸èƒ½åŒæ—¶å®‰è£…",
            ('opencv-python', 'opencv-contrib-python'): "å»ºè®®åªå®‰è£…opencv-contrib-python"
        }

        for conflict_pair, message in known_conflicts.items():
            if all(module in modules for module in conflict_pair):
                conflicts.update(conflict_pair)

        return conflicts

    def _generate_recommendations(self, analysis: Dict) -> List[str]:
        """ç”Ÿæˆä¼˜åŒ–å»ºè®®"""
        recommendations = []

        if analysis['missing_modules']:
            recommendations.append(
                f"å‘ç° {len(analysis['missing_modules'])} ä¸ªç¼ºå¤±æ¨¡å—ï¼Œ"
                f"å»ºè®®å®‰è£…: {', '.join(list(analysis['missing_modules'])[:5])}"
            )

        if analysis['conflicted_modules']:
            recommendations.append(
                f"å‘ç° {len(analysis['conflicted_modules'])} ä¸ªå†²çªæ¨¡å—ï¼Œ"
                "å»ºè®®æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§"
            )

        # æ ¹æ®æ£€æµ‹åˆ°çš„æ¡†æ¶æä¾›å»ºè®®
        detected = analysis['detected_modules']
        if 'django' in detected:
            recommendations.append("æ£€æµ‹åˆ°Djangoé¡¹ç›®ï¼Œå»ºè®®å¯ç”¨collect-allé€‰é¡¹")

        if 'numpy' in detected or 'pandas' in detected:
            recommendations.append("æ£€æµ‹åˆ°ç§‘å­¦è®¡ç®—åº“ï¼Œå»ºè®®å¢åŠ å†…å­˜é™åˆ¶")

        return recommendations
```

### é”™è¯¯å¤„ç†å¢å¼ºå®ç°

#### å…¨å±€å¼‚å¸¸å¤„ç†å™¨

```python
# utils/exception_handler.py
import sys
import traceback
import logging
from typing import Optional, Callable, Dict, Any
from PyQt5.QtWidgets import QMessageBox, QApplication
from PyQt5.QtCore import QObject, pyqtSignal

class GlobalExceptionHandler(QObject):
    """å…¨å±€å¼‚å¸¸å¤„ç†å™¨"""

    exception_occurred = pyqtSignal(str, str)  # å¼‚å¸¸ç±»å‹, å¼‚å¸¸ä¿¡æ¯

    def __init__(self):
        super().__init__()
        self.logger = logging.getLogger(__name__)
        self.error_solutions = self._load_error_solutions()

        # è®¾ç½®å…¨å±€å¼‚å¸¸å¤„ç†
        sys.excepthook = self.handle_exception

    def handle_exception(self, exc_type, exc_value, exc_traceback):
        """å¤„ç†æœªæ•è·çš„å¼‚å¸¸"""
        if issubclass(exc_type, KeyboardInterrupt):
            # å…è®¸Ctrl+Cæ­£å¸¸é€€å‡º
            sys.__excepthook__(exc_type, exc_value, exc_traceback)
            return

        # æ ¼å¼åŒ–å¼‚å¸¸ä¿¡æ¯
        error_msg = ''.join(traceback.format_exception(exc_type, exc_value, exc_traceback))
        error_type = exc_type.__name__

        # è®°å½•æ—¥å¿—
        self.logger.error(f"æœªå¤„ç†çš„å¼‚å¸¸: {error_type}\n{error_msg}")

        # æŸ¥æ‰¾è§£å†³æ–¹æ¡ˆ
        solution = self._find_solution(error_type, str(exc_value))

        # å‘é€ä¿¡å·
        self.exception_occurred.emit(error_type, str(exc_value))

        # æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯å¯¹è¯æ¡†
        self._show_error_dialog(error_type, str(exc_value), solution)

    def _load_error_solutions(self) -> Dict[str, Dict[str, Any]]:
        """åŠ è½½é”™è¯¯è§£å†³æ–¹æ¡ˆ"""
        return {
            'ModuleNotFoundError': {
                'pattern': 'No module named',
                'solution': 'ç¼ºå°‘å¿…è¦çš„Pythonæ¨¡å—',
                'actions': [
                    'æ£€æŸ¥requirements.txtæ–‡ä»¶',
                    'è¿è¡Œ: pip install -r requirements.txt',
                    'ç¡®è®¤è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»'
                ]
            },
            'FileNotFoundError': {
                'pattern': 'No such file or directory',
                'solution': 'æ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•',
                'actions': [
                    'æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®',
                    'ç¡®è®¤æ–‡ä»¶æ˜¯å¦å­˜åœ¨',
                    'æ£€æŸ¥æ–‡ä»¶æƒé™'
                ]
            },
            'PermissionError': {
                'pattern': 'Permission denied',
                'solution': 'æƒé™ä¸è¶³',
                'actions': [
                    'ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œç¨‹åº',
                    'æ£€æŸ¥æ–‡ä»¶/ç›®å½•æƒé™',
                    'ç¡®è®¤æ–‡ä»¶æœªè¢«å…¶ä»–ç¨‹åºå ç”¨'
                ]
            },
            'PyInstallerError': {
                'pattern': 'PyInstaller',
                'solution': 'PyInstalleræ‰“åŒ…é”™è¯¯',
                'actions': [
                    'æ£€æŸ¥PyInstallerç‰ˆæœ¬',
                    'æ¸…ç†buildå’Œdistç›®å½•',
                    'æ£€æŸ¥éšè—å¯¼å…¥é…ç½®',
                    'æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—'
                ]
            }
        }

    def _find_solution(self, error_type: str, error_message: str) -> Optional[Dict[str, Any]]:
        """æŸ¥æ‰¾é”™è¯¯è§£å†³æ–¹æ¡ˆ"""
        # ç²¾ç¡®åŒ¹é…é”™è¯¯ç±»å‹
        if error_type in self.error_solutions:
            solution = self.error_solutions[error_type]
            if solution['pattern'] in error_message:
                return solution

        # æ¨¡ç³ŠåŒ¹é…é”™è¯¯ä¿¡æ¯
        for solution_type, solution in self.error_solutions.items():
            if solution['pattern'].lower() in error_message.lower():
                return solution

        return None

    def _show_error_dialog(self, error_type: str, error_message: str, solution: Optional[Dict]):
        """æ˜¾ç¤ºé”™è¯¯å¯¹è¯æ¡†"""
        try:
            app = QApplication.instance()
            if not app:
                return

            # åˆ›å»ºé”™è¯¯å¯¹è¯æ¡†
            msg_box = QMessageBox()
            msg_box.setIcon(QMessageBox.Critical)
            msg_box.setWindowTitle("ç¨‹åºé”™è¯¯")

            # è®¾ç½®ä¸»è¦ä¿¡æ¯
            msg_box.setText(f"ç¨‹åºé‡åˆ°äº†ä¸€ä¸ªé”™è¯¯ï¼š{error_type}")

            # è®¾ç½®è¯¦ç»†ä¿¡æ¯
            if solution:
                detail_text = f"é”™è¯¯æè¿°ï¼š{error_message}\n\n"
                detail_text += f"å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š{solution['solution']}\n\n"
                detail_text += "å»ºè®®æ“ä½œï¼š\n"
                for i, action in enumerate(solution['actions'], 1):
                    detail_text += f"{i}. {action}\n"
            else:
                detail_text = f"é”™è¯¯è¯¦æƒ…ï¼š{error_message}\n\n"
                detail_text += "å»ºè®®ï¼š\n1. é‡å¯ç¨‹åº\n2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶\n3. è”ç³»æŠ€æœ¯æ”¯æŒ"

            msg_box.setDetailedText(detail_text)

            # æ·»åŠ æŒ‰é’®
            msg_box.addButton("ç¡®å®š", QMessageBox.AcceptRole)
            if solution and 'auto_fix' in solution:
                msg_box.addButton("è‡ªåŠ¨ä¿®å¤", QMessageBox.ActionRole)

            msg_box.exec_()

        except Exception as e:
            # å¼‚å¸¸å¤„ç†å™¨æœ¬èº«å‡ºé”™æ—¶çš„åå¤‡æ–¹æ¡ˆ
            print(f"å¼‚å¸¸å¤„ç†å™¨é”™è¯¯: {e}")
            print(f"åŸå§‹é”™è¯¯: {error_type}: {error_message}")
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥å’Œå®æ–½

### æµ‹è¯•æ¡†æ¶é…ç½®

#### å®‰è£…æµ‹è¯•ä¾èµ–
```bash
pip install pytest pytest-qt pytest-cov pytest-mock
```

#### æµ‹è¯•ç›®å½•ç»“æ„
```
tests/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ conftest.py                 # pytesté…ç½®
â”œâ”€â”€ unit/                       # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_models.py
â”‚   â”œâ”€â”€ test_services.py
â”‚   â””â”€â”€ test_utils.py
â”œâ”€â”€ integration/                # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_packaging_flow.py
â”‚   â””â”€â”€ test_ui_integration.py
â”œâ”€â”€ ui/                        # UIæµ‹è¯•
â”‚   â”œâ”€â”€ test_main_window.py
â”‚   â””â”€â”€ test_dialogs.py
â””â”€â”€ fixtures/                  # æµ‹è¯•æ•°æ®
    â”œâ”€â”€ sample_scripts/
    â””â”€â”€ config_files/
```

#### å•å…ƒæµ‹è¯•ç¤ºä¾‹

```python
# tests/unit/test_models.py
import pytest
import os
import tempfile
from unittest.mock import Mock, patch
from models.packer_model import PyInstallerModel
from config.app_config import AppConfig

class TestPyInstallerModel:
    """PyInstallerModelå•å…ƒæµ‹è¯•"""

    @pytest.fixture
    def config(self):
        """æµ‹è¯•é…ç½®"""
        return AppConfig()

    @pytest.fixture
    def model(self, config):
        """æµ‹è¯•æ¨¡å‹"""
        return PyInstallerModel(config)

    def test_model_initialization(self, model):
        """æµ‹è¯•æ¨¡å‹åˆå§‹åŒ–"""
        assert model.script_path == ""
        assert model.is_one_file == True
        assert model.is_windowed == False
        assert isinstance(model.additional_files, list)

    def test_validate_config_empty_script(self, model):
        """æµ‹è¯•ç©ºè„šæœ¬è·¯å¾„éªŒè¯"""
        errors = model.validate_config()
        assert "è¯·é€‰æ‹©è¦æ‰“åŒ…çš„Pythonè„šæœ¬æ–‡ä»¶" in errors

    def test_validate_config_nonexistent_script(self, model):
        """æµ‹è¯•ä¸å­˜åœ¨çš„è„šæœ¬æ–‡ä»¶éªŒè¯"""
        model.script_path = "nonexistent.py"
        errors = model.validate_config()
        assert any("è„šæœ¬æ–‡ä»¶ä¸å­˜åœ¨" in error for error in errors)

    def test_validate_config_valid_script(self, model):
        """æµ‹è¯•æœ‰æ•ˆè„šæœ¬éªŒè¯"""
        with tempfile.NamedTemporaryFile(suffix='.py', delete=False) as f:
            f.write(b'print("Hello World")')
            temp_script = f.name

        try:
            model.script_path = temp_script
            errors = model.validate_config()
            # åº”è¯¥æ²¡æœ‰å…³äºè„šæœ¬è·¯å¾„çš„é”™è¯¯
            assert not any("è„šæœ¬æ–‡ä»¶" in error for error in errors)
        finally:
            os.unlink(temp_script)

    def test_generate_command_basic(self, model):
        """æµ‹è¯•åŸºæœ¬å‘½ä»¤ç”Ÿæˆ"""
        with tempfile.NamedTemporaryFile(suffix='.py', delete=False) as f:
            temp_script = f.name

        try:
            model.script_path = temp_script
            model.output_dir = "./dist"
            model.is_one_file = True

            command = model.generate_command()

            assert "pyinstaller" in command.lower()
            assert "--onefile" in command
            assert temp_script in command
        finally:
            os.unlink(temp_script)

    @patch('os.path.exists')
    def test_generate_command_with_icon(self, mock_exists, model):
        """æµ‹è¯•å¸¦å›¾æ ‡çš„å‘½ä»¤ç”Ÿæˆ"""
        mock_exists.return_value = True

        model.script_path = "test.py"
        model.icon_path = "icon.ico"

        command = model.generate_command()
        assert "--icon=icon.ico" in command
```

#### UIæµ‹è¯•ç¤ºä¾‹

```python
# tests/ui/test_main_window.py
import pytest
import sys
from PyQt5.QtWidgets import QApplication
from PyQt5.QtTest import QTest
from PyQt5.QtCore import Qt
from views.main_window import MainWindow
from config.app_config import AppConfig
from models.packer_model import PyInstallerModel

@pytest.fixture(scope="session")
def qapp():
    """åˆ›å»ºQApplicationå®ä¾‹"""
    if not QApplication.instance():
        app = QApplication(sys.argv)
    else:
        app = QApplication.instance()
    yield app

class TestMainWindow:
    """ä¸»çª—å£UIæµ‹è¯•"""

    @pytest.fixture
    def main_window(self, qapp):
        """åˆ›å»ºä¸»çª—å£"""
        config = AppConfig()
        model = PyInstallerModel(config)
        window = MainWindow(config, model)
        window.show()
        return window

    def test_window_title(self, main_window):
        """æµ‹è¯•çª—å£æ ‡é¢˜"""
        expected_title = f"{AppConfig.APP_NAME} v{AppConfig.APP_VERSION}"
        assert main_window.windowTitle() == expected_title

    def test_tabs_creation(self, main_window):
        """æµ‹è¯•æ ‡ç­¾é¡µåˆ›å»º"""
        tab_widget = main_window.tab_widget
        assert tab_widget.count() == 5  # åŸºæœ¬ã€é«˜çº§ã€æ¨¡å—ã€è®¾ç½®ã€æ—¥å¿—

        tab_titles = [tab_widget.tabText(i) for i in range(tab_widget.count())]
        expected_titles = ["åŸºæœ¬è®¾ç½®", "é«˜çº§è®¾ç½®", "æ¨¡å—ç®¡ç†", "æ‰“åŒ…è®¾ç½®", "æ‰“åŒ…æ—¥å¿—"]
        assert tab_titles == expected_titles

    def test_buttons_exist(self, main_window):
        """æµ‹è¯•æŒ‰é’®å­˜åœ¨æ€§"""
        assert hasattr(main_window, 'start_package_btn')
        assert hasattr(main_window, 'cancel_package_btn')
        assert hasattr(main_window, 'generate_cmd_btn')
        assert hasattr(main_window, 'clear_config_btn')

    def test_start_package_button_click(self, main_window, qtbot):
        """æµ‹è¯•å¼€å§‹æ‰“åŒ…æŒ‰é’®ç‚¹å‡»"""
        # æ¨¡æ‹ŸæŒ‰é’®ç‚¹å‡»
        qtbot.mouseClick(main_window.start_package_btn, Qt.LeftButton)

        # éªŒè¯é”™è¯¯æç¤ºï¼ˆå› ä¸ºæ²¡æœ‰é€‰æ‹©è„šæœ¬ï¼‰
        # è¿™é‡Œéœ€è¦æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºäº†è­¦å‘Šå¯¹è¯æ¡†
        # å®é™…å®ç°ä¸­å¯èƒ½éœ€è¦mock QMessageBox

    def test_clear_config_button(self, main_window, qtbot):
        """æµ‹è¯•æ¸…ç©ºé…ç½®æŒ‰é’®"""
        # è®¾ç½®ä¸€äº›é…ç½®
        main_window.model.script_path = "test.py"
        main_window.model.is_one_file = False

        # ç‚¹å‡»æ¸…ç©ºæŒ‰é’®ï¼ˆéœ€è¦å¤„ç†ç¡®è®¤å¯¹è¯æ¡†ï¼‰
        with patch('PyQt5.QtWidgets.QMessageBox.question', return_value=QMessageBox.Yes):
            qtbot.mouseClick(main_window.clear_config_btn, Qt.LeftButton)

        # éªŒè¯é…ç½®è¢«æ¸…ç©º
        assert main_window.model.script_path == ""
        assert main_window.model.is_one_file == True
```

### æ€§èƒ½æµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•

#### æ¨¡å—æ£€æµ‹æ€§èƒ½æµ‹è¯•

```python
# tests/performance/test_module_detection_performance.py
import pytest
import time
import tempfile
import os
from services.enhanced_module_detector import EnhancedModuleDetector

class TestModuleDetectionPerformance:
    """æ¨¡å—æ£€æµ‹æ€§èƒ½æµ‹è¯•"""

    @pytest.fixture
    def large_script(self):
        """åˆ›å»ºå¤§å‹æµ‹è¯•è„šæœ¬"""
        script_content = """
import os
import sys
import json
import requests
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn import datasets
from tensorflow import keras
import torch
import cv2
from PyQt5.QtWidgets import QApplication
import django
from flask import Flask

# å¤§é‡çš„å‡½æ•°å’Œç±»å®šä¹‰
""" + "\n".join([f"def function_{i}(): pass" for i in range(1000)])

        with tempfile.NamedTemporaryFile(mode='w', suffix='.py', delete=False) as f:
            f.write(script_content)
            return f.name

    def test_detection_speed(self, large_script):
        """æµ‹è¯•æ£€æµ‹é€Ÿåº¦"""
        detector = EnhancedModuleDetector()

        # ç¬¬ä¸€æ¬¡æ£€æµ‹ï¼ˆæ— ç¼“å­˜ï¼‰
        start_time = time.time()
        modules_first = detector.detect_modules_with_cache(large_script)
        first_duration = time.time() - start_time

        # ç¬¬äºŒæ¬¡æ£€æµ‹ï¼ˆæœ‰ç¼“å­˜ï¼‰
        start_time = time.time()
        modules_second = detector.detect_modules_with_cache(large_script)
        second_duration = time.time() - start_time

        # éªŒè¯ç»“æœä¸€è‡´æ€§
        assert modules_first == modules_second

        # éªŒè¯ç¼“å­˜æ•ˆæœï¼ˆç¬¬äºŒæ¬¡åº”è¯¥æ›´å¿«ï¼‰
        assert second_duration < first_duration * 0.1  # è‡³å°‘å¿«10å€

        # æ€§èƒ½åŸºå‡†
        assert first_duration < 5.0  # é¦–æ¬¡æ£€æµ‹åº”åœ¨5ç§’å†…å®Œæˆ
        assert second_duration < 0.1  # ç¼“å­˜æ£€æµ‹åº”åœ¨0.1ç§’å†…å®Œæˆ

        print(f"é¦–æ¬¡æ£€æµ‹: {first_duration:.3f}s, ç¼“å­˜æ£€æµ‹: {second_duration:.3f}s")
        print(f"æ£€æµ‹åˆ° {len(modules_first)} ä¸ªæ¨¡å—")

        # æ¸…ç†
        os.unlink(large_script)
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

### æ€§èƒ½ç›‘æ§å·¥å…·

#### å†…å­˜ä½¿ç”¨ç›‘æ§

```python
# utils/performance_monitor.py
import psutil
import time
import threading
from typing import Dict, List, Callable, Optional
from PyQt5.QtCore import QObject, pyqtSignal, QTimer

class PerformanceMonitor(QObject):
    """æ€§èƒ½ç›‘æ§å™¨"""

    stats_updated = pyqtSignal(dict)  # ç»Ÿè®¡ä¿¡æ¯æ›´æ–°ä¿¡å·

    def __init__(self, interval: int = 1000):  # 1ç§’é—´éš”
        super().__init__()
        self.interval = interval
        self.timer = QTimer()
        self.timer.timeout.connect(self._collect_stats)
        self.process = psutil.Process()
        self.start_time = time.time()
        self.peak_memory = 0
        self.stats_history: List[Dict] = []

    def start_monitoring(self):
        """å¼€å§‹ç›‘æ§"""
        self.start_time = time.time()
        self.timer.start(self.interval)

    def stop_monitoring(self):
        """åœæ­¢ç›‘æ§"""
        self.timer.stop()

    def _collect_stats(self):
        """æ”¶é›†æ€§èƒ½ç»Ÿè®¡"""
        try:
            # CPUä½¿ç”¨ç‡
            cpu_percent = self.process.cpu_percent()

            # å†…å­˜ä½¿ç”¨
            memory_info = self.process.memory_info()
            memory_mb = memory_info.rss / 1024 / 1024
            self.peak_memory = max(self.peak_memory, memory_mb)

            # çº¿ç¨‹æ•°
            thread_count = self.process.num_threads()

            # è¿è¡Œæ—¶é—´
            runtime = time.time() - self.start_time

            stats = {
                'cpu_percent': cpu_percent,
                'memory_mb': memory_mb,
                'peak_memory_mb': self.peak_memory,
                'thread_count': thread_count,
                'runtime_seconds': runtime,
                'timestamp': time.time()
            }

            self.stats_history.append(stats)

            # åªä¿ç•™æœ€è¿‘100ä¸ªè®°å½•
            if len(self.stats_history) > 100:
                self.stats_history.pop(0)

            self.stats_updated.emit(stats)

        except Exception as e:
            print(f"æ€§èƒ½ç›‘æ§é”™è¯¯: {e}")

    def get_summary(self) -> Dict:
        """è·å–æ€§èƒ½æ‘˜è¦"""
        if not self.stats_history:
            return {}

        cpu_values = [s['cpu_percent'] for s in self.stats_history]
        memory_values = [s['memory_mb'] for s in self.stats_history]

        return {
            'avg_cpu_percent': sum(cpu_values) / len(cpu_values),
            'max_cpu_percent': max(cpu_values),
            'avg_memory_mb': sum(memory_values) / len(memory_values),
            'peak_memory_mb': self.peak_memory,
            'total_runtime': self.stats_history[-1]['runtime_seconds'],
            'sample_count': len(self.stats_history)
        }
```

### ä»£ç è´¨é‡æ£€æŸ¥é…ç½®

#### pylinté…ç½®æ–‡ä»¶

```ini
# .pylintrc
[MASTER]
init-hook='import sys; sys.path.append(".")'
jobs=1
load-plugins=
persistent=yes
suggestion-mode=yes
unsafe-load-any-extension=no

[MESSAGES CONTROL]
confidence=
disable=C0330,C0326,R0903,R0913,W0613,C0103,R0801

[REPORTS]
evaluation=10.0 - ((float(5 * error + warning + refactor + convention) / statement) * 10)
output-format=text
reports=no
score=yes

[REFACTORING]
max-nested-blocks=5
never-returning-functions=sys.exit

[BASIC]
argument-naming-style=snake_case
attr-naming-style=snake_case
bad-names=foo,bar,baz,toto,tutu,tata
class-attribute-naming-style=any
class-naming-style=PascalCase
const-naming-style=UPPER_CASE
function-naming-style=snake_case
good-names=i,j,k,ex,Run,_
include-naming-hint=no
inlinevar-naming-style=any
method-naming-style=snake_case
module-naming-style=snake_case
variable-naming-style=snake_case

[FORMAT]
expected-line-ending-format=
ignore-long-lines=^\s*(# )?<?https?://\S+>?$
indent-after-paren=4
indent-string='    '
max-line-length=100
max-module-lines=1000
single-line-class-stmt=no
single-line-if-stmt=no

[LOGGING]
logging-format-style=old
logging-modules=logging

[MISCELLANEOUS]
notes=FIXME,XXX,TODO

[SIMILARITIES]
ignore-comments=yes
ignore-docstrings=yes
ignore-imports=no
min-similarity-lines=4

[SPELLING]
max-spelling-suggestions=4
spelling-dict=
spelling-ignore-words=
spelling-private-dict-file=
spelling-store-unknown-words=no

[STRING]
check-str-concat-over-line-jumps=no

[TYPECHECK]
contextmanager-decorators=contextlib.contextmanager
generated-members=
ignore-mixin-members=yes
ignore-none=yes
ignore-on-opaque-inference=yes
ignored-classes=optparse.Values,thread._local,_thread._local
ignored-modules=
missing-member-hint=yes
missing-member-hint-distance=1
missing-member-max-choices=1

[VARIABLES]
additional-builtins=
allow-global-unused-variables=yes
callbacks=cb_,_cb
dummy-variables-rgx=_+$|(_[a-zA-Z0-9_]*[a-zA-Z0-9]+?$)|dummy|^ignored_|^unused_
ignored-argument-names=_.*|^ignored_|^unused_
init-import=no
redefining-builtins-modules=six.moves,past.builtins,future.builtins,builtins,io

[CLASSES]
defining-attr-methods=__init__,__new__,setUp,__post_init__
exclude-protected=_asdict,_fields,_replace,_source,_make
valid-classmethod-first-arg=cls
valid-metaclass-classmethod-first-arg=cls
```

#### GitHub Actions CIé…ç½®

```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        python-version: [3.8, 3.9, '3.10', 3.11]

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install system dependencies (Ubuntu)
      if: matrix.os == 'ubuntu-latest'
      run: |
        sudo apt-get update
        sudo apt-get install -y xvfb

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install -r requirements-dev.txt

    - name: Lint with pylint
      run: |
        pylint --rcfile=.pylintrc **/*.py

    - name: Format check with black
      run: |
        black --check --diff .

    - name: Type check with mypy
      run: |
        mypy --config-file=mypy.ini .

    - name: Test with pytest
      run: |
        pytest --cov=. --cov-report=xml --cov-report=html
      env:
        QT_QPA_PLATFORM: offscreen

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml
        flags: unittests
        name: codecov-umbrella
        fail_ci_if_error: true

  build:
    needs: test
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller

    - name: Build executable
      run: |
        python build_optimized.py

    - name: Test executable
      run: |
        ./dist/PyInstaller-GUI.exe --version

    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: PyInstaller-GUI-${{ github.sha }}
        path: dist/
```

## ğŸ“‹ é¡¹ç›®è¿›åº¦è·Ÿè¸ªè¡¨

### å¼€å‘é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | ç›®æ ‡æ—¥æœŸ | çŠ¶æ€ | å®Œæˆåº¦ | è´Ÿè´£äºº | å¤‡æ³¨ |
|--------|----------|------|--------|--------|------|
| é¡¹ç›®åˆ†æå®Œæˆ | 2025-01-21 | âœ… å®Œæˆ | 100% | åˆ†æå›¢é˜Ÿ | å·²è¯†åˆ«æ‰€æœ‰ä¼˜åŒ–ç‚¹ |
| å¼€å‘æ–‡æ¡£å®Œæˆ | 2025-01-21 | ğŸŸ¡ è¿›è¡Œä¸­ | 90% | æ–‡æ¡£å›¢é˜Ÿ | å¾…å®Œå–„éƒ¨åˆ†ç»†èŠ‚ |
| æ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ– | 2025-03-01 | â³ è®¡åˆ’ä¸­ | 0% | å¾…åˆ†é… | åŒ…å«å¼‚æ­¥å¤„ç†ç­‰ |
| ç”¨æˆ·ä½“éªŒæå‡ | 2025-03-15 | â³ è®¡åˆ’ä¸­ | 0% | å¾…åˆ†é… | UIç°ä»£åŒ–æ”¹é€  |
| æ‰©å±•åŠŸèƒ½å¼€å‘ | 2025-04-30 | â³ è®¡åˆ’ä¸­ | 0% | å¾…åˆ†é… | é«˜çº§åŠŸèƒ½å®ç° |
| æµ‹è¯•å®Œå–„ | 2025-05-15 | â³ è®¡åˆ’ä¸­ | 0% | æµ‹è¯•å›¢é˜Ÿ | å…¨é¢æµ‹è¯•è¦†ç›– |
| æ–‡æ¡£å®Œå–„ | 2025-05-30 | â³ è®¡åˆ’ä¸­ | 0% | æ–‡æ¡£å›¢é˜Ÿ | ç”¨æˆ·æ‰‹å†Œç­‰ |
| æ­£å¼å‘å¸ƒ | 2025-06-15 | â³ è®¡åˆ’ä¸­ | 0% | å‘å¸ƒå›¢é˜Ÿ | v2.0ç‰ˆæœ¬å‘å¸ƒ |

### è¯¦ç»†ä»»åŠ¡è¿›åº¦

#### ä¼˜å…ˆçº§1ï¼šæ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ– (é¢„è®¡4-6å‘¨)

| ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | å¼€å§‹æ—¥æœŸ | ç»“æŸæ—¥æœŸ | çŠ¶æ€ | å®Œæˆåº¦ | é˜»å¡é—®é¢˜ |
|------|----------|----------|----------|------|--------|----------|
| å¼‚æ­¥æ‰“åŒ…å¤„ç† | 2å‘¨ | TBD | TBD | â³ å¾…å¼€å§‹ | 0% | éœ€è¦åˆ†é…å¼€å‘äººå‘˜ |
| æ™ºèƒ½ä¾èµ–æ£€æµ‹ä¼˜åŒ– | 2-3å‘¨ | TBD | TBD | â³ å¾…å¼€å§‹ | 0% | éœ€è¦ç®—æ³•è®¾è®¡ |
| é”™è¯¯å¤„ç†å¢å¼º | 1-2å‘¨ | TBD | TBD | â³ å¾…å¼€å§‹ | 0% | ä¾èµ–å¼‚æ­¥å¤„ç†å®Œæˆ |

#### ä¼˜å…ˆçº§2ï¼šç”¨æˆ·ä½“éªŒæå‡ (é¢„è®¡3-4å‘¨)

| ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | å¼€å§‹æ—¥æœŸ | ç»“æŸæ—¥æœŸ | çŠ¶æ€ | å®Œæˆåº¦ | é˜»å¡é—®é¢˜ |
|------|----------|----------|----------|------|--------|----------|
| ç•Œé¢ç°ä»£åŒ– | 2-3å‘¨ | TBD | TBD | â³ å¾…å¼€å§‹ | 0% | éœ€è¦UIè®¾è®¡å¸ˆ |
| åŠŸèƒ½å¢å¼º | 1-2å‘¨ | TBD | TBD | â³ å¾…å¼€å§‹ | 0% | ä¾èµ–ç•Œé¢ç°ä»£åŒ– |

#### ä¼˜å…ˆçº§3ï¼šæ‰©å±•åŠŸèƒ½ (é¢„è®¡6-8å‘¨)

| ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | å¼€å§‹æ—¥æœŸ | ç»“æŸæ—¥æœŸ | çŠ¶æ€ | å®Œæˆåº¦ | é˜»å¡é—®é¢˜ |
|------|----------|----------|----------|------|--------|----------|
| é«˜çº§åŠŸèƒ½å¼€å‘ | 4-5å‘¨ | TBD | TBD | â³ å¾…å¼€å§‹ | 0% | éœ€è¦æ¶æ„è®¾è®¡ |
| å¼€å‘è€…å·¥å…· | 2-3å‘¨ | TBD | TBD | â³ å¾…å¼€å§‹ | 0% | ä¾èµ–é«˜çº§åŠŸèƒ½ |

## ğŸ¯ æœ€ä½³å®è·µæŒ‡å—

### ä»£ç å¼€å‘æœ€ä½³å®è·µ

#### 1. ä»£ç ç»“æ„å’Œç»„ç»‡

```python
# æ¨èçš„æ–‡ä»¶å¤´éƒ¨æ³¨é‡Šæ ¼å¼
"""
æ¨¡å—åç§°ï¼šå¼‚æ­¥æ‰“åŒ…æœåŠ¡
åŠŸèƒ½æè¿°ï¼šæä¾›å¼‚æ­¥çš„PyInstalleræ‰“åŒ…åŠŸèƒ½
ä½œè€…ï¼šå¼€å‘å›¢é˜Ÿ
åˆ›å»ºæ—¥æœŸï¼š2025-01-21
æœ€åä¿®æ”¹ï¼š2025-01-21
ç‰ˆæœ¬ï¼š1.0.0
"""

# å¯¼å…¥é¡ºåºï¼šæ ‡å‡†åº“ -> ç¬¬ä¸‰æ–¹åº“ -> æœ¬åœ°æ¨¡å—
import os
import sys
from typing import Optional, List, Dict

from PyQt5.QtCore import QThread, pyqtSignal
import pyinstaller

from config.app_config import AppConfig
from utils.logger import log_info, log_error
```

#### 2. å‡½æ•°å’Œç±»è®¾è®¡åŸåˆ™

```python
class AsyncPackageService:
    """
    å¼‚æ­¥æ‰“åŒ…æœåŠ¡ç±»

    èŒè´£ï¼š
    - ç®¡ç†å¼‚æ­¥æ‰“åŒ…ä»»åŠ¡
    - æä¾›è¿›åº¦å›è°ƒ
    - å¤„ç†æ‰“åŒ…é”™è¯¯

    ä½¿ç”¨ç¤ºä¾‹ï¼š
        service = AsyncPackageService(model)
        service.progress_updated.connect(callback)
        service.start_packaging()
    """

    def __init__(self, model: PyInstallerModel, config: AppConfig):
        """
        åˆå§‹åŒ–å¼‚æ­¥æ‰“åŒ…æœåŠ¡

        Args:
            model: æ‰“åŒ…é…ç½®æ¨¡å‹
            config: åº”ç”¨é…ç½®

        Raises:
            ValueError: å½“modelæˆ–configä¸ºNoneæ—¶
        """
        if not model or not config:
            raise ValueError("modelå’Œconfigå‚æ•°ä¸èƒ½ä¸ºNone")

        self.model = model
        self.config = config
        self._worker: Optional[AsyncPackageWorker] = None

    def start_packaging(self) -> bool:
        """
        å¼€å§‹å¼‚æ­¥æ‰“åŒ…

        Returns:
            bool: æˆåŠŸå¯åŠ¨è¿”å›Trueï¼Œå¦åˆ™è¿”å›False

        Raises:
            RuntimeError: å½“å·²æœ‰æ‰“åŒ…ä»»åŠ¡åœ¨è¿è¡Œæ—¶
        """
        if self._worker and self._worker.isRunning():
            raise RuntimeError("å·²æœ‰æ‰“åŒ…ä»»åŠ¡åœ¨è¿è¡Œä¸­")

        try:
            self._worker = AsyncPackageWorker(self.model)
            self._worker.start()
            return True
        except Exception as e:
            log_error(f"å¯åŠ¨æ‰“åŒ…ä»»åŠ¡å¤±è´¥: {e}")
            return False
```

#### 3. é”™è¯¯å¤„ç†æ¨¡å¼

```python
# æ¨èçš„é”™è¯¯å¤„ç†æ¨¡å¼
def process_file(file_path: str) -> Optional[Dict]:
    """
    å¤„ç†æ–‡ä»¶çš„æ¨èé”™è¯¯å¤„ç†æ¨¡å¼
    """
    try:
        # å‚æ•°éªŒè¯
        if not file_path:
            raise ValueError("æ–‡ä»¶è·¯å¾„ä¸èƒ½ä¸ºç©º")

        if not os.path.exists(file_path):
            raise FileNotFoundError(f"æ–‡ä»¶ä¸å­˜åœ¨: {file_path}")

        # ä¸»è¦é€»è¾‘
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        result = {"content": content, "size": len(content)}
        log_info(f"æˆåŠŸå¤„ç†æ–‡ä»¶: {file_path}")
        return result

    except (ValueError, FileNotFoundError) as e:
        # é¢„æœŸçš„é”™è¯¯ï¼Œè®°å½•å¹¶é‡æ–°æŠ›å‡º
        log_error(f"æ–‡ä»¶å¤„ç†å‚æ•°é”™è¯¯: {e}")
        raise

    except PermissionError as e:
        # æƒé™é”™è¯¯ï¼Œæä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯
        log_error(f"æ–‡ä»¶è®¿é—®æƒé™ä¸è¶³: {file_path}")
        raise RuntimeError(f"æ— æ³•è®¿é—®æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥æƒé™: {file_path}") from e

    except Exception as e:
        # æœªé¢„æœŸçš„é”™è¯¯ï¼Œè®°å½•è¯¦ç»†ä¿¡æ¯
        log_error(f"å¤„ç†æ–‡ä»¶æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {file_path}, é”™è¯¯: {e}")
        raise RuntimeError(f"æ–‡ä»¶å¤„ç†å¤±è´¥: {file_path}") from e
```

#### 4. æµ‹è¯•ç¼–å†™æŒ‡å—

```python
# æµ‹è¯•ç±»å‘½åå’Œç»„ç»‡
class TestAsyncPackageService:
    """å¼‚æ­¥æ‰“åŒ…æœåŠ¡æµ‹è¯•ç±»"""

    @pytest.fixture
    def mock_model(self):
        """åˆ›å»ºæ¨¡æ‹Ÿçš„æ‰“åŒ…æ¨¡å‹"""
        model = Mock(spec=PyInstallerModel)
        model.script_path = "test.py"
        model.output_dir = "./dist"
        model.validate_config.return_value = []
        model.generate_command.return_value = "pyinstaller test.py"
        return model

    @pytest.fixture
    def service(self, mock_model):
        """åˆ›å»ºæµ‹è¯•ç”¨çš„æœåŠ¡å®ä¾‹"""
        config = AppConfig()
        return AsyncPackageService(mock_model, config)

    def test_init_with_valid_params(self, mock_model):
        """æµ‹è¯•æ­£å¸¸åˆå§‹åŒ–"""
        config = AppConfig()
        service = AsyncPackageService(mock_model, config)

        assert service.model == mock_model
        assert service.config == config
        assert service._worker is None

    def test_init_with_none_model(self):
        """æµ‹è¯•modelä¸ºNoneçš„æƒ…å†µ"""
        config = AppConfig()

        with pytest.raises(ValueError, match="modelå’Œconfigå‚æ•°ä¸èƒ½ä¸ºNone"):
            AsyncPackageService(None, config)

    def test_start_packaging_success(self, service, mock_model):
        """æµ‹è¯•æˆåŠŸå¯åŠ¨æ‰“åŒ…"""
        with patch('services.async_package_service.AsyncPackageWorker') as MockWorker:
            mock_worker = Mock()
            MockWorker.return_value = mock_worker

            result = service.start_packaging()

            assert result is True
            MockWorker.assert_called_once_with(mock_model)
            mock_worker.start.assert_called_once()

    def test_start_packaging_already_running(self, service):
        """æµ‹è¯•é‡å¤å¯åŠ¨æ‰“åŒ…çš„æƒ…å†µ"""
        # æ¨¡æ‹Ÿå·²æœ‰ä»»åŠ¡åœ¨è¿è¡Œ
        service._worker = Mock()
        service._worker.isRunning.return_value = True

        with pytest.raises(RuntimeError, match="å·²æœ‰æ‰“åŒ…ä»»åŠ¡åœ¨è¿è¡Œä¸­"):
            service.start_packaging()
```

### UIå¼€å‘æœ€ä½³å®è·µ

#### 1. ç»„ä»¶è®¾è®¡åŸåˆ™

```python
class ModernButton(QPushButton):
    """ç°ä»£åŒ–æŒ‰é’®ç»„ä»¶"""

    def __init__(self, text: str, button_type: str = "primary", parent=None):
        """
        åˆå§‹åŒ–ç°ä»£åŒ–æŒ‰é’®

        Args:
            text: æŒ‰é’®æ–‡æœ¬
            button_type: æŒ‰é’®ç±»å‹ (primary, secondary, danger)
            parent: çˆ¶ç»„ä»¶
        """
        super().__init__(text, parent)
        self.button_type = button_type
        self._setup_style()
        self._setup_animations()

    def _setup_style(self):
        """è®¾ç½®æŒ‰é’®æ ·å¼"""
        styles = {
            "primary": """
                QPushButton {
                    background-color: #2196F3;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    padding: 8px 16px;
                    font-weight: 500;
                }
                QPushButton:hover {
                    background-color: #1976D2;
                }
                QPushButton:pressed {
                    background-color: #0D47A1;
                }
                QPushButton:disabled {
                    background-color: #BDBDBD;
                    color: #757575;
                }
            """,
            "secondary": """
                QPushButton {
                    background-color: transparent;
                    color: #2196F3;
                    border: 1px solid #2196F3;
                    border-radius: 6px;
                    padding: 8px 16px;
                    font-weight: 500;
                }
                QPushButton:hover {
                    background-color: #E3F2FD;
                }
            """,
            "danger": """
                QPushButton {
                    background-color: #F44336;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    padding: 8px 16px;
                    font-weight: 500;
                }
                QPushButton:hover {
                    background-color: #D32F2F;
                }
            """
        }

        self.setStyleSheet(styles.get(self.button_type, styles["primary"]))

    def _setup_animations(self):
        """è®¾ç½®æŒ‰é’®åŠ¨ç”»æ•ˆæœ"""
        # è¿™é‡Œå¯ä»¥æ·»åŠ QPropertyAnimationç­‰åŠ¨ç”»æ•ˆæœ
        pass
```

#### 2. å“åº”å¼å¸ƒå±€è®¾è®¡

```python
class ResponsiveLayout(QVBoxLayout):
    """å“åº”å¼å¸ƒå±€ç®¡ç†å™¨"""

    def __init__(self, parent=None):
        super().__init__(parent)
        self.breakpoints = {
            'small': 600,
            'medium': 960,
            'large': 1280
        }
        self.current_size = 'large'

    def resizeEvent(self, event):
        """å¤„ç†çª—å£å¤§å°å˜åŒ–"""
        width = event.size().width()

        new_size = 'large'
        if width < self.breakpoints['small']:
            new_size = 'small'
        elif width < self.breakpoints['medium']:
            new_size = 'medium'

        if new_size != self.current_size:
            self.current_size = new_size
            self._adjust_layout()

    def _adjust_layout(self):
        """æ ¹æ®å±å¹•å¤§å°è°ƒæ•´å¸ƒå±€"""
        if self.current_size == 'small':
            # å°å±å¹•ï¼šå‚ç›´å¸ƒå±€ï¼Œéšè—éƒ¨åˆ†å…ƒç´ 
            self.setDirection(QBoxLayout.TopToBottom)
        elif self.current_size == 'medium':
            # ä¸­ç­‰å±å¹•ï¼šæ··åˆå¸ƒå±€
            pass
        else:
            # å¤§å±å¹•ï¼šæ°´å¹³å¸ƒå±€ï¼Œæ˜¾ç¤ºæ‰€æœ‰å…ƒç´ 
            self.setDirection(QBoxLayout.LeftToRight)
```

### æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

#### 1. å†…å­˜ç®¡ç†

```python
class ResourceManager:
    """èµ„æºç®¡ç†å™¨"""

    def __init__(self):
        self._resources: Dict[str, Any] = {}
        self._cleanup_callbacks: List[Callable] = []

    def register_resource(self, name: str, resource: Any, cleanup_callback: Optional[Callable] = None):
        """æ³¨å†Œèµ„æº"""
        self._resources[name] = resource
        if cleanup_callback:
            self._cleanup_callbacks.append(cleanup_callback)

    def get_resource(self, name: str) -> Optional[Any]:
        """è·å–èµ„æº"""
        return self._resources.get(name)

    def cleanup(self):
        """æ¸…ç†æ‰€æœ‰èµ„æº"""
        for callback in self._cleanup_callbacks:
            try:
                callback()
            except Exception as e:
                log_error(f"èµ„æºæ¸…ç†å¤±è´¥: {e}")

        self._resources.clear()
        self._cleanup_callbacks.clear()

    def __enter__(self):
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        self.cleanup()

# ä½¿ç”¨ç¤ºä¾‹
def process_large_data():
    """å¤„ç†å¤§é‡æ•°æ®çš„ç¤ºä¾‹"""
    with ResourceManager() as rm:
        # æ³¨å†Œéœ€è¦æ¸…ç†çš„èµ„æº
        large_data = load_large_dataset()
        rm.register_resource("dataset", large_data, lambda: del large_data)

        temp_files = create_temp_files()
        rm.register_resource("temp_files", temp_files, cleanup_temp_files)

        # å¤„ç†æ•°æ®
        result = process_data(large_data)
        return result
        # èµ„æºä¼šåœ¨é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†
```

#### 2. ç¼“å­˜ç­–ç•¥

```python
from functools import lru_cache
import time
from typing import Any, Dict, Optional

class TimedCache:
    """å¸¦è¿‡æœŸæ—¶é—´çš„ç¼“å­˜"""

    def __init__(self, default_ttl: int = 300):  # 5åˆ†é’Ÿé»˜è®¤è¿‡æœŸæ—¶é—´
        self.default_ttl = default_ttl
        self._cache: Dict[str, Dict[str, Any]] = {}

    def get(self, key: str) -> Optional[Any]:
        """è·å–ç¼“å­˜å€¼"""
        if key not in self._cache:
            return None

        entry = self._cache[key]
        if time.time() > entry['expires']:
            del self._cache[key]
            return None

        return entry['value']

    def set(self, key: str, value: Any, ttl: Optional[int] = None) -> None:
        """è®¾ç½®ç¼“å­˜å€¼"""
        ttl = ttl or self.default_ttl
        self._cache[key] = {
            'value': value,
            'expires': time.time() + ttl
        }

    def clear_expired(self) -> None:
        """æ¸…ç†è¿‡æœŸç¼“å­˜"""
        current_time = time.time()
        expired_keys = [
            key for key, entry in self._cache.items()
            if current_time > entry['expires']
        ]

        for key in expired_keys:
            del self._cache[key]

# ä½¿ç”¨è£…é¥°å™¨å®ç°æ–¹æ³•ç¼“å­˜
def cached_method(ttl: int = 300):
    """æ–¹æ³•ç¼“å­˜è£…é¥°å™¨"""
    def decorator(func):
        cache = TimedCache(ttl)

        def wrapper(*args, **kwargs):
            # ç”Ÿæˆç¼“å­˜é”®
            cache_key = f"{func.__name__}_{hash(str(args) + str(kwargs))}"

            # å°è¯•ä»ç¼“å­˜è·å–
            result = cache.get(cache_key)
            if result is not None:
                return result

            # æ‰§è¡Œå‡½æ•°å¹¶ç¼“å­˜ç»“æœ
            result = func(*args, **kwargs)
            cache.set(cache_key, result)
            return result

        return wrapper
    return decorator

# ä½¿ç”¨ç¤ºä¾‹
class ModuleDetector:
    @cached_method(ttl=600)  # ç¼“å­˜10åˆ†é’Ÿ
    def detect_modules(self, script_path: str) -> Set[str]:
        """æ£€æµ‹æ¨¡å—ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        # å®é™…çš„æ£€æµ‹é€»è¾‘
        return self._do_detection(script_path)
```

## ğŸ“š å­¦ä¹ èµ„æºå’Œå‚è€ƒæ–‡æ¡£

### æŠ€æœ¯æ–‡æ¡£é“¾æ¥

#### Pythonå¼€å‘
- [Pythonå®˜æ–¹æ–‡æ¡£](https://docs.python.org/3/)
- [PEP 8 ç¼–ç è§„èŒƒ](https://pep8.org/)
- [Pythonç±»å‹æ³¨è§£æŒ‡å—](https://docs.python.org/3/library/typing.html)
- [asyncioå¼‚æ­¥ç¼–ç¨‹](https://docs.python.org/3/library/asyncio.html)

#### PyQt5å¼€å‘
- [PyQt5å®˜æ–¹æ–‡æ¡£](https://doc.qt.io/qtforpython/)
- [Qtæ ·å¼è¡¨å‚è€ƒ](https://doc.qt.io/qt-5/stylesheet.html)
- [Qtä¿¡å·æ§½æœºåˆ¶](https://doc.qt.io/qt-5/signalsandslots.html)
- [Qtå¤šçº¿ç¨‹ç¼–ç¨‹](https://doc.qt.io/qt-5/threads.html)

#### PyInstaller
- [PyInstallerå®˜æ–¹æ–‡æ¡£](https://pyinstaller.readthedocs.io/)
- [PyInstalleré«˜çº§ç”¨æ³•](https://pyinstaller.readthedocs.io/en/stable/advanced-topics.html)
- [PyInstalleré’©å­ç¼–å†™](https://pyinstaller.readthedocs.io/en/stable/hooks.html)

#### æµ‹è¯•å’Œè´¨é‡ä¿è¯
- [pytestæ–‡æ¡£](https://docs.pytest.org/)
- [pytest-qtæ’ä»¶](https://pytest-qt.readthedocs.io/)
- [coverage.pyæ–‡æ¡£](https://coverage.readthedocs.io/)
- [pylintæ–‡æ¡£](https://pylint.pycqa.org/)

### è®¾è®¡èµ„æº

#### UI/UXè®¾è®¡
- [Material DesignæŒ‡å—](https://material.io/design)
- [Human Interface Guidelines](https://developer.apple.com/design/human-interface-guidelines/)
- [Fluent Design System](https://www.microsoft.com/design/fluent/)

#### å›¾æ ‡å’Œç´ æ
- [Material Design Icons](https://materialdesignicons.com/)
- [Feather Icons](https://feathericons.com/)
- [Unsplash](https://unsplash.com/) - å…è´¹å›¾ç‰‡ç´ æ

### å¼€å‘å·¥å…·æ¨è

#### IDEå’Œç¼–è¾‘å™¨
- [PyCharm Professional](https://www.jetbrains.com/pycharm/) - åŠŸèƒ½æœ€å…¨é¢çš„Python IDE
- [Visual Studio Code](https://code.visualstudio.com/) - è½»é‡çº§ä½†åŠŸèƒ½å¼ºå¤§
- [Sublime Text](https://www.sublimetext.com/) - å¿«é€Ÿå“åº”çš„æ–‡æœ¬ç¼–è¾‘å™¨

#### è°ƒè¯•å’Œåˆ†æå·¥å…·
- [pdb](https://docs.python.org/3/library/pdb.html) - Pythonå†…ç½®è°ƒè¯•å™¨
- [memory_profiler](https://pypi.org/project/memory-profiler/) - å†…å­˜ä½¿ç”¨åˆ†æ
- [py-spy](https://github.com/benfred/py-spy) - æ€§èƒ½åˆ†æå·¥å…·
- [Qt Creator](https://www.qt.io/product/development-tools) - Qtåº”ç”¨å¼€å‘å’Œè°ƒè¯•

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-01-21
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
